---
id: install
title: Installing stLearn
sidebar_label: Install stLearn
---



```python
from utils import tab_printer
#from parser import parameter_parser
from capsgnn import CapsGNNTrainer
import argparse
```


```python
def parameter_parser():
    """
    A method to parse up command line parameters. By default it learns on the Watts-Strogatz dataset.
    The default hyperparameters give good results without cross-validation.
    """
    parser = argparse.ArgumentParser(description = "Run CapsGNN.")
    
    parser.add_argument("--train-graph-folder",
                        nargs = "?",
                        default = "./input/train/",
                    help = "Training graphs folder.")

    parser.add_argument("--test-graph-folder",
                        nargs = "?",
                        default = "./input/test/",
                    help = "Testing graphs folder.")

    parser.add_argument("--prediction-path",
                        nargs = "?",
                        default = "./output/watts_predictions.csv",
                    help = "Path to store the predicted graph labels.")

    parser.add_argument("--epochs",
                        type = int,
                        default = 100,
                    help = "Number of training epochs. Default is 100.")

    parser.add_argument("--batch-size",
                        type = int,
                        default = 32,
                    help = "Number of graphs processed per batch. Default is 32.")

    parser.add_argument("--gcn-filters",
                        type = int,
                        default = 20,
                    help = "Number of Graph Convolutional filters. Default is 20.")

    parser.add_argument("--gcn-layers",
                        type = int,
                        default = 2,
                    help = "Number of Graph Convolutional Layers. Default is 2.")

    parser.add_argument("--inner-attention-dimension",
                        type = int,
                        default = 20,
                    help = "Number of Attention Neurons. Default is 20.")

    parser.add_argument("--capsule-dimensions",
                        type = int,
                        default = 8,
                    help = "Capsule dimensions. Default is 8.")

    parser.add_argument("--number-of-capsules",
                        type = int,
                        default = 8,
                    help = "Number of capsules per layer. Default is 8.")

    parser.add_argument("--weight-decay",
                        type = float,
                        default = 10**-6,
                    help = "Weight decay. Default is 10^-6.")

    parser.add_argument("--learning-rate",
                        type = float,
                        default = 0.01,
                    help = "Learning rate. Default is 0.01.")

    parser.add_argument("--lambd",
                        type = float,
                        default = 0.5,
                    help = "Loss combination weight. Default is 0.5.")

    parser.add_argument("--theta",
                        type = float,
                        default = 0.1,
                    help = "Reconstruction loss weight. Default is 0.1.")
    
    return parser.parse_args()
```


```python
import sys; sys.argv=['']; del sys
args = parameter_parser()
```


```python
model = CapsGNNTrainer(args)
```

    
    Enumerating feature and target values.
    
    


    HBox(children=(IntProgress(value=0, max=4110), HTML(value='')))


    
    


```python
from torchviz import make_dot
```


    ---------------------------------------------------------------------------

    ModuleNotFoundError                       Traceback (most recent call last)

    <ipython-input-5-1054c009c1b5> in <module>
    ----> 1 from torchviz import make_dot
    

    ModuleNotFoundError: No module named 'torchviz'



```python

```


```python
model = CapsGNNTrainer(args)
model.fit()
model.score()
model.save_predictions()
```

    
    Enumerating feature and target values.
    
    


    HBox(children=(IntProgress(value=0, max=4110), HTML(value='')))


    
    
    Training started.
    
    


    HBox(children=(IntProgress(value=0, description='Epochs: ', style=ProgressStyle(description_width='initial')),…


    CapsGNN (Loss=1.852): 100%|██████████████████████████████████████████████████████████| 113/113 [00:55<00:00,  2.17it/s]
    CapsGNN (Loss=1.5165): 100%|█████████████████████████████████████████████████████████| 113/113 [00:50<00:00,  2.56it/s]
    CapsGNN (Loss=1.5041): 100%|█████████████████████████████████████████████████████████| 113/113 [00:49<00:00,  2.58it/s]
    CapsGNN (Loss=1.5017): 100%|█████████████████████████████████████████████████████████| 113/113 [00:50<00:00,  2.59it/s]
    CapsGNN (Loss=1.4969): 100%|█████████████████████████████████████████████████████████| 113/113 [00:47<00:00,  2.49it/s]
    CapsGNN (Loss=1.4955): 100%|█████████████████████████████████████████████████████████| 113/113 [00:46<00:00,  2.59it/s]
    CapsGNN (Loss=1.49): 100%|███████████████████████████████████████████████████████████| 113/113 [00:46<00:00,  2.60it/s]
    CapsGNN (Loss=1.4859): 100%|█████████████████████████████████████████████████████████| 113/113 [00:46<00:00,  2.66it/s]
    CapsGNN (Loss=1.4848): 100%|█████████████████████████████████████████████████████████| 113/113 [00:46<00:00,  2.58it/s]
    CapsGNN (Loss=1.4816): 100%|█████████████████████████████████████████████████████████| 113/113 [00:46<00:00,  2.63it/s]
    CapsGNN (Loss=1.482): 100%|██████████████████████████████████████████████████████████| 113/113 [00:47<00:00,  2.52it/s]
    CapsGNN (Loss=1.4799): 100%|█████████████████████████████████████████████████████████| 113/113 [00:48<00:00,  2.54it/s]
    CapsGNN (Loss=1.4794): 100%|█████████████████████████████████████████████████████████| 113/113 [00:47<00:00,  2.50it/s]
    CapsGNN (Loss=1.4778): 100%|█████████████████████████████████████████████████████████| 113/113 [00:49<00:00,  2.33it/s]
    CapsGNN (Loss=1.4756): 100%|█████████████████████████████████████████████████████████| 113/113 [00:47<00:00,  2.55it/s]
    CapsGNN (Loss=1.4732): 100%|█████████████████████████████████████████████████████████| 113/113 [00:46<00:00,  2.43it/s]
    CapsGNN (Loss=1.469): 100%|██████████████████████████████████████████████████████████| 113/113 [00:47<00:00,  2.52it/s]
    CapsGNN (Loss=1.4621): 100%|█████████████████████████████████████████████████████████| 113/113 [00:47<00:00,  2.55it/s]
    CapsGNN (Loss=1.4568): 100%|█████████████████████████████████████████████████████████| 113/113 [00:47<00:00,  2.51it/s]
    CapsGNN (Loss=1.453): 100%|██████████████████████████████████████████████████████████| 113/113 [00:47<00:00,  2.56it/s]
    CapsGNN (Loss=1.4512): 100%|█████████████████████████████████████████████████████████| 113/113 [00:47<00:00,  2.58it/s]
    CapsGNN (Loss=1.4484): 100%|█████████████████████████████████████████████████████████| 113/113 [00:47<00:00,  2.55it/s]
    CapsGNN (Loss=1.4442): 100%|█████████████████████████████████████████████████████████| 113/113 [00:47<00:00,  2.53it/s]
    CapsGNN (Loss=1.4404): 100%|█████████████████████████████████████████████████████████| 113/113 [00:47<00:00,  2.53it/s]
    CapsGNN (Loss=1.439): 100%|██████████████████████████████████████████████████████████| 113/113 [00:48<00:00,  2.41it/s]
    CapsGNN (Loss=1.4356): 100%|█████████████████████████████████████████████████████████| 113/113 [00:47<00:00,  2.56it/s]
    CapsGNN (Loss=1.432): 100%|██████████████████████████████████████████████████████████| 113/113 [00:47<00:00,  2.57it/s]
    CapsGNN (Loss=1.4308): 100%|█████████████████████████████████████████████████████████| 113/113 [00:47<00:00,  2.52it/s]
    CapsGNN (Loss=1.4287): 100%|█████████████████████████████████████████████████████████| 113/113 [00:47<00:00,  2.59it/s]
    CapsGNN (Loss=1.4268): 100%|█████████████████████████████████████████████████████████| 113/113 [00:48<00:00,  2.51it/s]
    CapsGNN (Loss=1.425): 100%|██████████████████████████████████████████████████████████| 113/113 [00:47<00:00,  2.47it/s]
    CapsGNN (Loss=1.4218): 100%|█████████████████████████████████████████████████████████| 113/113 [00:47<00:00,  2.50it/s]
    CapsGNN (Loss=1.4186): 100%|█████████████████████████████████████████████████████████| 113/113 [00:47<00:00,  2.59it/s]
    CapsGNN (Loss=1.417): 100%|██████████████████████████████████████████████████████████| 113/113 [00:47<00:00,  2.49it/s]
    CapsGNN (Loss=1.4128): 100%|█████████████████████████████████████████████████████████| 113/113 [00:48<00:00,  2.56it/s]
    CapsGNN (Loss=1.4113): 100%|█████████████████████████████████████████████████████████| 113/113 [00:48<00:00,  2.49it/s]
    CapsGNN (Loss=1.4101): 100%|█████████████████████████████████████████████████████████| 113/113 [00:48<00:00,  2.44it/s]
    CapsGNN (Loss=1.4078): 100%|█████████████████████████████████████████████████████████| 113/113 [00:48<00:00,  2.50it/s]
    CapsGNN (Loss=1.4077): 100%|█████████████████████████████████████████████████████████| 113/113 [00:47<00:00,  2.53it/s]
    CapsGNN (Loss=1.4072): 100%|█████████████████████████████████████████████████████████| 113/113 [00:48<00:00,  2.53it/s]
    CapsGNN (Loss=1.4013): 100%|█████████████████████████████████████████████████████████| 113/113 [00:48<00:00,  2.49it/s]
    CapsGNN (Loss=1.4053): 100%|█████████████████████████████████████████████████████████| 113/113 [00:47<00:00,  2.36it/s]
    CapsGNN (Loss=1.3992): 100%|█████████████████████████████████████████████████████████| 113/113 [00:48<00:00,  2.46it/s]
    CapsGNN (Loss=1.3963): 100%|█████████████████████████████████████████████████████████| 113/113 [00:47<00:00,  2.49it/s]
    CapsGNN (Loss=1.3943): 100%|█████████████████████████████████████████████████████████| 113/113 [00:48<00:00,  2.44it/s]
    CapsGNN (Loss=1.3916): 100%|█████████████████████████████████████████████████████████| 113/113 [00:48<00:00,  2.52it/s]
    CapsGNN (Loss=1.3902): 100%|█████████████████████████████████████████████████████████| 113/113 [00:47<00:00,  2.45it/s]
    CapsGNN (Loss=1.389): 100%|██████████████████████████████████████████████████████████| 113/113 [00:48<00:00,  2.54it/s]
    CapsGNN (Loss=1.3878): 100%|█████████████████████████████████████████████████████████| 113/113 [00:47<00:00,  2.50it/s]
    CapsGNN (Loss=1.3861): 100%|█████████████████████████████████████████████████████████| 113/113 [00:48<00:00,  2.50it/s]
    CapsGNN (Loss=1.3835): 100%|█████████████████████████████████████████████████████████| 113/113 [00:48<00:00,  2.52it/s]
    CapsGNN (Loss=1.3818): 100%|█████████████████████████████████████████████████████████| 113/113 [00:48<00:00,  2.44it/s]
    CapsGNN (Loss=1.3819): 100%|█████████████████████████████████████████████████████████| 113/113 [00:48<00:00,  2.54it/s]
    CapsGNN (Loss=1.3805): 100%|█████████████████████████████████████████████████████████| 113/113 [00:48<00:00,  2.52it/s]
    CapsGNN (Loss=1.3796): 100%|█████████████████████████████████████████████████████████| 113/113 [00:48<00:00,  2.35it/s]
    CapsGNN (Loss=1.3771): 100%|█████████████████████████████████████████████████████████| 113/113 [00:48<00:00,  2.41it/s]
    CapsGNN (Loss=1.3767): 100%|█████████████████████████████████████████████████████████| 113/113 [00:48<00:00,  2.41it/s]
    CapsGNN (Loss=1.3775): 100%|█████████████████████████████████████████████████████████| 113/113 [00:48<00:00,  2.32it/s]
    CapsGNN (Loss=1.3754): 100%|█████████████████████████████████████████████████████████| 113/113 [00:47<00:00,  2.41it/s]
    CapsGNN (Loss=1.3734): 100%|█████████████████████████████████████████████████████████| 113/113 [00:48<00:00,  2.45it/s]
    CapsGNN (Loss=1.3728): 100%|█████████████████████████████████████████████████████████| 113/113 [00:48<00:00,  2.47it/s]
    CapsGNN (Loss=1.3754): 100%|█████████████████████████████████████████████████████████| 113/113 [00:48<00:00,  2.44it/s]
    CapsGNN (Loss=1.3708): 100%|█████████████████████████████████████████████████████████| 113/113 [00:47<00:00,  2.53it/s]
    CapsGNN (Loss=1.3708): 100%|█████████████████████████████████████████████████████████| 113/113 [00:47<00:00,  2.48it/s]
    CapsGNN (Loss=1.3697): 100%|█████████████████████████████████████████████████████████| 113/113 [00:47<00:00,  2.49it/s]
    CapsGNN (Loss=1.3674): 100%|█████████████████████████████████████████████████████████| 113/113 [00:48<00:00,  2.50it/s]
    CapsGNN (Loss=1.3679): 100%|█████████████████████████████████████████████████████████| 113/113 [00:47<00:00,  2.50it/s]
    CapsGNN (Loss=1.3662): 100%|█████████████████████████████████████████████████████████| 113/113 [00:48<00:00,  2.50it/s]
    CapsGNN (Loss=1.3641): 100%|█████████████████████████████████████████████████████████| 113/113 [00:48<00:00,  2.50it/s]
    CapsGNN (Loss=1.3674): 100%|█████████████████████████████████████████████████████████| 113/113 [00:47<00:00,  2.58it/s]
    CapsGNN (Loss=1.3646): 100%|█████████████████████████████████████████████████████████| 113/113 [00:48<00:00,  2.56it/s]
    CapsGNN (Loss=1.3655): 100%|█████████████████████████████████████████████████████████| 113/113 [00:47<00:00,  2.48it/s]
    CapsGNN (Loss=1.3614): 100%|█████████████████████████████████████████████████████████| 113/113 [00:48<00:00,  2.47it/s]
    CapsGNN (Loss=1.362): 100%|██████████████████████████████████████████████████████████| 113/113 [00:48<00:00,  2.53it/s]
    CapsGNN (Loss=1.3596): 100%|█████████████████████████████████████████████████████████| 113/113 [00:48<00:00,  2.03it/s]
    CapsGNN (Loss=1.3627): 100%|█████████████████████████████████████████████████████████| 113/113 [00:48<00:00,  2.45it/s]
    CapsGNN (Loss=1.359): 100%|██████████████████████████████████████████████████████████| 113/113 [00:48<00:00,  2.45it/s]
    CapsGNN (Loss=1.3602): 100%|█████████████████████████████████████████████████████████| 113/113 [00:48<00:00,  2.48it/s]
    CapsGNN (Loss=1.3597): 100%|█████████████████████████████████████████████████████████| 113/113 [00:48<00:00,  2.48it/s]
    CapsGNN (Loss=1.3594): 100%|█████████████████████████████████████████████████████████| 113/113 [00:50<00:00,  2.37it/s]
    CapsGNN (Loss=1.3582): 100%|█████████████████████████████████████████████████████████| 113/113 [00:48<00:00,  2.50it/s]
    CapsGNN (Loss=1.3566): 100%|█████████████████████████████████████████████████████████| 113/113 [00:48<00:00,  2.52it/s]
    CapsGNN (Loss=1.3578): 100%|█████████████████████████████████████████████████████████| 113/113 [00:48<00:00,  2.46it/s]
    CapsGNN (Loss=1.3547): 100%|█████████████████████████████████████████████████████████| 113/113 [00:48<00:00,  2.42it/s]
    CapsGNN (Loss=1.3565): 100%|█████████████████████████████████████████████████████████| 113/113 [00:49<00:00,  2.28it/s]
    CapsGNN (Loss=1.355): 100%|██████████████████████████████████████████████████████████| 113/113 [00:57<00:00,  2.02it/s]
    CapsGNN (Loss=1.3561): 100%|█████████████████████████████████████████████████████████| 113/113 [00:57<00:00,  2.31it/s]
    CapsGNN (Loss=1.355): 100%|██████████████████████████████████████████████████████████| 113/113 [01:00<00:00,  2.00it/s]
    CapsGNN (Loss=1.3542): 100%|█████████████████████████████████████████████████████████| 113/113 [00:56<00:00,  1.91it/s]
    CapsGNN (Loss=1.354): 100%|██████████████████████████████████████████████████████████| 113/113 [00:57<00:00,  1.86it/s]
    CapsGNN (Loss=1.3538): 100%|█████████████████████████████████████████████████████████| 113/113 [00:53<00:00,  2.45it/s]
    CapsGNN (Loss=1.3543): 100%|█████████████████████████████████████████████████████████| 113/113 [00:49<00:00,  2.46it/s]
    CapsGNN (Loss=1.3548): 100%|█████████████████████████████████████████████████████████| 113/113 [00:48<00:00,  2.45it/s]
    CapsGNN (Loss=1.3518): 100%|█████████████████████████████████████████████████████████| 113/113 [00:48<00:00,  2.48it/s]
    CapsGNN (Loss=1.3528): 100%|█████████████████████████████████████████████████████████| 113/113 [00:48<00:00,  2.44it/s]
    CapsGNN (Loss=1.3499): 100%|█████████████████████████████████████████████████████████| 113/113 [00:48<00:00,  2.24it/s]
    CapsGNN (Loss=1.3502): 100%|█████████████████████████████████████████████████████████| 113/113 [00:49<00:00,  2.47it/s]
    CapsGNN (Loss=1.349): 100%|██████████████████████████████████████████████████████████| 113/113 [00:50<00:00,  1.81it/s]
    CapsGNN (Loss=1.3506): 100%|█████████████████████████████████████████████████████████| 113/113 [01:06<00:00,  1.48it/s]
    CapsGNN (Loss=1.3554): 100%|█████████████████████████████████████████████████████████| 113/113 [01:21<00:00,  1.47it/s]
    

    
    
    
    Scoring.
    
    


    HBox(children=(IntProgress(value=0, max=500), HTML(value='')))


    
    
    Accuracy: 0.704
    


```python
from tqdm import tqdm
import glob
ending = "*.json"

test_graph_paths = glob.glob(args.test_graph_folder+ending)
result= []
hits = []

for path in tqdm(test_graph_paths):
    data = model.create_input_data(path)
    prediction, reconstruction_loss = model(data)
    prediction_mag = torch.sqrt((prediction**2).sum(dim=2))
    _, prediction_max_index = prediction_mag.max(dim=1)
    prediction = prediction_max_index.data.view(-1).item()
    result.append(prediction)
    hits.append(data["target"][prediction]==1)
```

      0%|                                                                                          | 0/332 [00:00<?, ?it/s]
    


    ---------------------------------------------------------------------------

    TypeError                                 Traceback (most recent call last)

    <ipython-input-11-d9255c207464> in <module>
          8 for path in tqdm(test_graph_paths):
          9     data = model.create_input_data(path)
    ---> 10     prediction, reconstruction_loss = model(data)
         11     prediction_mag = torch.sqrt((prediction**2).sum(dim=2))
         12     _, prediction_max_index = prediction_mag.max(dim=1)
    

    TypeError: 'CapsGNNTrainer' object is not callable



```python
model = CapsGNNTrainer(args)
```

    
    Enumerating feature and target values.
    
    


    HBox(children=(IntProgress(value=0, max=4110), HTML(value='')))


    
    


```python
from tqdm import tqdm
import glob
ending = "*.json"

test_graph_paths = glob.glob(args.train_graph_folder+ending)
```


```python
model.create_input_data(test_graph_paths[0])
```




    {'target': tensor([1., 0.]),
     'edges': tensor([[ 7,  7,  9,  9, 19,  6, 10,  5, 16,  0,  1, 11, 16, 17,  2,  3, 14,  5,
              11, 12,  7, 10, 13, 10, 15, 11, 14,  9, 13, 15, 12, 14,  6,  8, 18,  8,
              19, 16,  4, 17, 20, 19,  0,  1,  2,  3,  4,  5,  5,  6,  6,  7,  7,  7,
               8,  8,  9,  9,  9, 10, 10, 10, 11, 11, 11, 12, 12, 13, 13, 14, 14, 14,
              15, 15, 16, 16, 16, 17, 17, 18, 19, 19, 19, 20],
             [ 0,  1,  2,  3,  4,  5,  5,  6,  6,  7,  7,  7,  8,  8,  9,  9,  9, 10,
              10, 10, 11, 11, 11, 12, 12, 13, 13, 14, 14, 14, 15, 15, 16, 16, 16, 17,
              17, 18, 19, 19, 19, 20,  7,  7,  9,  9, 19,  6, 10,  5, 16,  0,  1, 11,
              16, 17,  2,  3, 14,  5, 11, 12,  7, 10, 13, 10, 15, 11, 14,  9, 13, 15,
              12, 14,  6,  8, 18,  8, 19, 16,  4, 17, 20, 19]]),
     'features': tensor([[0., 0., 0.,  ..., 0., 0., 0.],
             [0., 0., 0.,  ..., 0., 0., 0.],
             [0., 0., 0.,  ..., 0., 0., 0.],
             ...,
             [0., 0., 0.,  ..., 0., 0., 0.],
             [0., 0., 0.,  ..., 0., 0., 0.],
             [0., 0., 0.,  ..., 0., 0., 0.]])}




```python

```
